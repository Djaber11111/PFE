<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†Ù†ØµØ© Ø´ÙÙØ§Ø¡ Ø§Ù„Ù…ÙˆØ­Ø¯Ø© | Ø­Ø¬Ø² Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø·Ø¨ÙŠØ©</title>
    
    <!-- ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    
    <!-- Supabase Client Library -->
    <!-- Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙƒØªØ¨Ø© ØªÙ†Ø´Ø¦ Ù…ØªØºÙŠØ±Ø§Ù‹ Ø¹Ø§Ù…Ø§Ù‹ Ø§Ø³Ù…Ù‡ supabase Ù„Ø°Ù„Ùƒ Ù„Ø§ ÙŠØ¬Ø¨ Ø£Ù† Ù†Ø¹ÙŠØ¯ ØªØ¹Ø±ÙŠÙÙ‡ -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        :root {
            /* Ù„ÙˆØ­Ø© Ø£Ù„ÙˆØ§Ù† Ø¹ØµØ±ÙŠØ© Ù…Ø±ÙŠØ­Ø© Ù„Ù„Ø¹ÙŠÙ† */
            --p-color: #00b894; --p-dark: #00897b;
            --s-color: #0984e3; --a-color: #6c5ce7;
            --d-color: #d63031; --bg-main: #f5f6fa;
            --text-p: #2d3436; --glass: rgba(255, 255, 255, 0.9);
            --border: rgba(0, 0, 0, 0.08);
            --tip-bg: #fff9db; --tip-txt: #856404;
        }

        .dark-mode {
            --bg-main: #0f141e; --text-p: #f5f6fa;
            --glass: rgba(25, 30, 45, 0.95);
            --border: rgba(255, 255, 255, 0.1);
            --tip-bg: #2d2d14; --tip-txt: #f1c40f;
            --s-color: #74b9ff;
        }

        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø¹Ø§Ù…Ø© */
        * { box-sizing: border-box; transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            margin: 0; min-height: 100vh; color: var(--text-p);
            /* ØªÙ… ÙˆØ¶Ø¹ Ù„ÙˆÙ† Ø§Ø­ØªÙŠØ§Ø·ÙŠ ÙÙŠ Ø­Ø§Ù„ Ø¹Ø¯Ù… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© */
            background-color: var(--bg-main);
            background-image: url('photo_2026-01-25_20-35-42.jpg');
            background-repeat: no-repeat;
            background-position: center center;
            background-attachment: fixed;
            background-size: cover; 
            overflow-x: hidden;
        }

        .overlay {
            background: rgba(245, 246, 250, 0.75);
            min-height: 100vh; width: 100%; backdrop-filter: blur(15px);
            display: flex; flex-direction: column;
        }
        .dark-mode .overlay { background: rgba(10, 15, 25, 0.9); }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        nav {
            padding: 15px 5%; background: var(--glass);
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 1000;
        }
        .brand { font-size: 1.6rem; font-weight: 900; color: var(--p-color); display: flex; align-items: center; gap: 10px; }
        .clock-24 { font-family: 'Courier New', monospace; font-weight: bold; font-size: 1.2rem; color: var(--s-color); }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¨Ø­Ø« */
        .search-container {
            flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 50px 20px; text-align: center;
        }
        .search-card {
            background: var(--glass); padding: 45px; border-radius: 40px;
            width: 100%; max-width: 650px; box-shadow: 0 30px 60px rgba(0,0,0,0.15);
            border: 1px solid var(--border);
        }

        .input-wrap { position: relative; margin-top: 25px; text-align: right; }
        .input-wrap label { display: block; margin-bottom: 8px; font-weight: 600; opacity: 0.8; }
        .input-wrap i { position: absolute; right: 18px; top: 44px; color: var(--p-color); z-index: 2; }

        input, select, textarea {
            width: 100%; padding: 15px 50px 15px 15px; border-radius: 15px;
            border: 1px solid var(--border); background: var(--bg-main);
            color: var(--text-p); font-size: 1rem; outline: none;
        }
        input:focus { border-color: var(--p-color); box-shadow: 0 0 15px rgba(0, 184, 148, 0.2); }

        .action-btn {
            background: linear-gradient(135deg, var(--p-color), var(--s-color));
            color: white; border: none; padding: 18px; border-radius: 15px;
            font-weight: bold; cursor: pointer; width: 100%; margin-top: 20px;
            display: flex; align-items: center; justify-content: center; gap: 10px; font-size: 1.1rem;
        }
        .action-btn:hover { transform: translateY(-3px); filter: brightness(1.1); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }

        /* Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³ØªØ´ÙÙŠØ§Øª */
        .hosp-list { margin-top: 15px; border-radius: 15px; overflow: hidden; background: var(--bg-main); }
        .hosp-item { padding: 15px; cursor: pointer; border-bottom: 1px solid var(--border); text-align: right; }
        .hosp-item:hover { background: var(--p-color); color: white; }

        /* ØªÙ…Ø±ÙƒØ² Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ ÙÙŠ Ø§Ù„Ø­Ø¬Ø² */
        .hospital-header-center {
            grid-column: 1 / -1; text-align: center; margin-bottom: 30px;
            padding: 20px; background: rgba(0, 184, 148, 0.1); border-radius: 20px;
            border: 2px dashed var(--p-color);
        }

        /* Ø´Ø¨ÙƒØ© Ø§Ù„Ø­Ø¬Ø² */
        .booking-grid { display: none; width: 100%; max-width: 1100px; gap: 30px; padding: 40px 20px; margin: 0 auto; }
        .card-service {
            background: var(--glass); padding: 35px; border-radius: 30px; flex: 1;
            min-width: 320px; border: 1px solid var(--border); text-align: center;
        }

        /* Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ */
        .ai-panel {
            position: fixed; bottom: 120px; left: 30px; width: 360px; height: 520px;
            background: var(--glass); border: 1px solid var(--p-color); border-radius: 25px;
            display: none; flex-direction: column; z-index: 9999; box-shadow: 0 25px 50px rgba(0,0,0,0.3);
        }
        .chat-top { background: var(--p-color); color: white; padding: 18px; border-radius: 25px 25px 0 0; font-weight: bold; display: flex; justify-content: space-between; }
        .chat-mid { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; }
        .bubble { padding: 12px 18px; border-radius: 20px; font-size: 0.95rem; max-width: 85%; line-height: 1.5; }
        .b-bot { background: rgba(0,0,0,0.05); align-self: flex-start; }
        .b-user { background: var(--p-color); color: white; align-self: flex-end; }

        /* Ø£Ø²Ø±Ø§Ø± Ø¹Ø§Ø¦Ù…Ø© */
        .fab { width: 70px; height: 70px; border-radius: 50%; color: white; display: flex; align-items: center; justify-content: center; font-size: 1.8rem; cursor: pointer; position: fixed; bottom: 30px; z-index: 9000; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .fab-ai { left: 30px; background: var(--a-color); }
        .fab-em { right: 30px; background: var(--d-color); animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(214, 48, 49, 0.7); } 70% { transform: scale(1.1); box-shadow: 0 0 0 20px rgba(214, 48, 49, 0); } 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(214, 48, 49, 0); } }

        /* Ù…ÙˆØ¯Ø§Ù„Ø§Øª */
        .modal-full { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); backdrop-filter: blur(10px); z-index: 10000; align-items: center; justify-content: center; }
        .modal-box { background: var(--glass); padding: 40px; border-radius: 35px; width: 95%; max-width: 500px; text-align: center; position: relative; }

        .tip-card {
            background: var(--tip-bg); color: var(--tip-txt);
            padding: 22px; border-radius: 20px; margin-bottom: 25px;
            text-align: right; border-right: 8px solid var(--p-color); font-weight: bold;
        }

        .form-area { display: none; margin-top: 25px; text-align: right; border-top: 1px solid var(--border); padding-top: 20px; }
        
        #loader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-main); z-index: 30000; display: flex; align-items: center; justify-content: center; }
        .spin { width: 60px; height: 60px; border: 6px solid #e1e1e1; border-top-color: var(--p-color); border-radius: 50%; animation: rot 1s infinite linear; }
        @keyframes rot { to { transform: rotate(360deg); } }
    </style>
</head>
<body>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
<div id="loader"><div class="spin"></div></div>

<div class="overlay">
    <nav>
        <div class="brand"><i class="fas fa-hand-holding-medical"></i> <span>Ù†ÙØ¸Ø§Ù… Ø´ÙÙØ§Ø¡</span></div>
        <div style="display: flex; gap: 20px; align-items: center;">
            <div id="lang-selector" style="position: relative;">
                <i class="fas fa-globe" style="cursor: pointer; font-size: 1.4rem; color: var(--p-color);" onclick="toggleLangMenu()" title="Ø§Ø®ØªØ± Ø§Ù„Ù„ØºØ©"></i>
                <div id="lang-menu" style="display: none; position: absolute; top: 45px; left: 0; background: var(--glass); border: 2px solid var(--p-color); border-radius: 15px; min-width: 150px; z-index: 1000; box-shadow: 0 10px 30px rgba(0,0,0,0.3); overflow: hidden;">
                    <button onclick="setLanguage('ar')" style="width: 100%; padding: 12px 15px; border: none; background: none; color: #333; cursor: pointer; text-align: right; transition: all 0.3s; font-weight: bold; border-bottom: 1px solid #eee;" onmouseover="this.style.background='#f0f0f0'" onmouseout="this.style.background='none'">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø¹</button>
                    <button onclick="setLanguage('en')" style="width: 100%; padding: 12px 15px; border: none; background: none; color: #333; cursor: pointer; text-align: right; transition: all 0.3s; font-weight: bold; border-bottom: 1px solid #eee;" onmouseover="this.style.background='#f0f0f0'" onmouseout="this.style.background='none'">English En</button>
                    <button onclick="setLanguage('fr')" style="width: 100%; padding: 12px 15px; border: none; background: none; color: #333; cursor: pointer; text-align: right; transition: all 0.3s; font-weight: bold;" onmouseover="this.style.background='#f0f0f0'" onmouseout="this.style.background='none'">FranÃ§ais Fr</button>
                </div>
            </div>
            <i class="fas fa-circle-half-stroke" style="cursor: pointer; font-size: 1.4rem;" onclick="toggleTheme()"></i>
        </div>
    </nav>

    <main class="search-container" id="home-sec">
        <div class="search-card">
            <h1 style="margin: 0 0 10px 0; color: var(--p-dark);" data-i18n="title">Ø§Ø­Ø¬Ø² Ù…Ø³ØªÙ‚Ø¨Ù„Ùƒ Ø§Ù„ØµØ­ÙŠ Ø§Ù„ÙŠÙˆÙ…</h1>
            <p style="opacity: 0.6;" data-i18n="subtitle">Ø§Ù„Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„ÙˆØ·Ù†ÙŠØ© Ø§Ù„Ø±Ù‚Ù…ÙŠØ© Ù„Ø±Ø¨Ø· Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø¨Ø§Ù„Ù…Ø¤Ø³Ø³Ø§Øª Ø§Ù„Ø§Ø³ØªØ´ÙØ§Ø¦ÙŠØ©</p>
            
            <div class="input-wrap">
                <label data-i18n="selectHospital">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ Ø£Ùˆ Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø·Ø¨ÙŠ:</label>
                <i class="fas fa-search-location"></i>
                <input type="text" id="h-input" onkeyup="filterHosp()" data-i18n-placeholder="searchPlaceholder" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ Ø£Ùˆ Ø§Ù„ÙˆÙ„Ø§ÙŠØ©...">
                <div id="h-results" class="hosp-list"></div>
            </div>

            <div style="margin: 35px 0; display: flex; align-items: center; gap: 15px;">
                <hr style="flex:1; opacity: 0.1;"> <span style="font-size: 0.85rem; opacity: 0.5;" data-i18n="or">Ø£Ùˆ Ø§Ø³ØªØ¹Ù„Ù… Ø¹Ù† Ù…ÙˆØ¹Ø¯Ùƒ</span> <hr style="flex:1; opacity: 0.1;">
            </div>

            <div class="input-wrap">
                <i class="fas fa-phone-volume"></i>
                <input type="tel" id="track-id" data-i18n-placeholder="trackPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø³Ø¬Ù„ Ù„Ù„Ø­Ø¬Ø²...">
            </div>
            <button class="action-btn" onclick="trackBooking()"><i class="fas fa-microchip"></i> <span data-i18n="trackBtn">Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø²</span></button>
        </div>
    </main>

    <section class="booking-grid" id="book-sec">
        <div class="hospital-header-center">
            <h2 id="current-hosp" style="margin:0; color: var(--p-dark);"></h2>
            <small style="opacity:0.6;">Ø§Ù„Ù…Ø¤Ø³Ø³Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„ÙØ­Øµ</small>
        </div>

        <div class="card-service" id="c-clinic" onclick="expandForm('clinic')">
            <i class="fas fa-user-md" style="font-size: 4rem; color: var(--s-color); margin-bottom: 20px;"></i>
            <h3 data-i18n="clinicTitle">Ù…ÙˆØ¹Ø¯ Ø·Ø¨ÙŠØ¨ Ø£Ø®ØµØ§Ø¦ÙŠ</h3>
            <p data-i18n="clinicDesc">Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª Ø§Ù„Ø¯ÙˆØ±ÙŠØ© ÙˆØ§Ù„ÙØ­ÙˆØµØ§Øª Ø§Ù„ØªØ®ØµØµÙŠØ©</p>
            
            <div id="form-clinic" class="form-area" onclick="event.stopPropagation()">
                <div style="display: flex; gap: 10px; margin-bottom: 12px;">
                    <input type="text" id="p-fn" data-i18n-placeholder="firstName" placeholder="Ø§Ù„Ø§Ø³Ù…">
                    <input type="text" id="p-ln" data-i18n-placeholder="lastName" placeholder="Ø§Ù„Ù„Ù‚Ø¨">
                </div>
                <div class="input-wrap" style="margin-top:0;">
                    <label data-i18n="nin">Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙ Ø§Ù„ÙˆØ·Ù†ÙŠ (NIN):</label>
                    <input type="number" id="p-nin" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…ÙƒÙˆÙ† Ù…Ù† 18 Ø®Ø§Ù†Ø©" style="padding: 12px 15px;">
                </div>
                <div class="input-wrap">
                    <label data-i18n="phone">Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø±ÙŠØ¶:</label>
                    <input type="tel" id="p-tel" placeholder="06XXXXXXXX" style="padding: 12px 15px;">
                </div>
                <select id="p-spec" style="margin: 15px 0;">
                    <option value="">-- Ø§Ø®ØªØ± Ø§Ù„ØªØ®ØµØµ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ --</option>
                    <option value="general">Ø§Ù„Ø·Ø¨ Ø§Ù„Ø¹Ø§Ù…</option>
                    <option value="eyes">Ø£Ù…Ø±Ø§Ø¶ Ø§Ù„Ø¹ÙŠÙˆÙ†</option>
                    <option value="heart">Ø£Ù…Ø±Ø§Ø¶ Ø§Ù„Ù‚Ù„Ø¨</option>
                    <option value="neuro">Ø§Ù„Ø£Ø¹ØµØ§Ø¨</option>
                    <option value="children">Ø§Ù„Ø£Ø·ÙØ§Ù„</option>
                </select>
                <input type="date" id="p-date" style="margin-bottom: 20px;">
                <button class="action-btn" onclick="confirmFinal('clinic')"><span data-i18n="confirmBtn">ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ÙˆØ¹Ø¯</span></button>
            </div>
        </div>

        <div class="card-service" id="c-home" onclick="expandForm('home')">
            <i class="fas fa-house-chimney-medical" style="font-size: 4rem; color: var(--p-color); margin-bottom: 20px;"></i>
            <h3 data-i18n="homeTitle">Ø§Ù„Ø±Ø¹Ø§ÙŠØ© Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ©</h3>
            <p data-i18n="homeDesc">Ø·Ù„Ø¨ Ø·Ø§Ù‚Ù… Ø·Ø¨ÙŠ Ù„Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ù…Ø±ÙŠØ¶ ÙÙŠ Ù…Ù†Ø²Ù„Ù‡</p>
            
            <div id="form-home" class="form-area" onclick="event.stopPropagation()">
                <input type="text" id="h-name" data-i18n-placeholder="patientName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ù…Ø±ÙŠØ¶" style="margin-bottom: 12px;">
                <input type="tel" id="h-tel" data-i18n-placeholder="guardianPhone" placeholder="Ø±Ù‚Ù… Ù‡Ø§ØªÙ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±" style="margin-bottom: 12px;">
                <textarea id="h-case" rows="3" data-i18n-placeholder="caseDesc" placeholder="ÙˆØµÙ Ù…ÙˆØ¬Ø² Ù„Ù„Ø­Ø§Ù„Ø© Ø§Ù„ØµØ­ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©..."></textarea>
                <input type="text" id="h-addr" data-i18n-placeholder="address" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø³ÙƒÙ†ÙŠ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ" style="margin: 15px 0;">
                <button class="action-btn" style="background: var(--p-color);" onclick="confirmFinal('home')"><span data-i18n="submitBtn">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¹Ø§Ø¬Ù„</span></button>
            </div>
        </div>
    </section>
</div>

<div class="fab fab-ai" onclick="toggleAI()"><i class="fas fa-robot"></i></div>
<div class="fab fab-em" onclick="toggleEM()"><i class="fas fa-ambulance"></i></div>

<div id="ai-win" class="ai-panel">
    <div class="chat-top"><span>ğŸ¤– Ù…Ø³Ø§Ø¹Ø¯ Ø´ÙØ§Ø¡ Ø§Ù„Ø°ÙƒÙŠ</span><i class="fas fa-times" onclick="toggleAI()" style="cursor:pointer; font-size:1.2rem;"></i></div>
    <div class="chat-mid" id="chat-logs">
        <div class="bubble b-bot">Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹! ğŸ˜Š\n\nØ£Ù†Ø§ Ø´ÙØ§Ø¡ØŒ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒÙŠ ÙÙŠ Ù…Ù†ØµØ© Ø´ÙØ§Ø¡ ğŸ’™\n\nØ£Ù†Ø§ Ù‡Ù†Ø§ Ù„Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ ÙƒÙ„ Ø´ÙŠØ¡:\nğŸ¥ Ø­Ø¬Ø² Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø·Ø¨ÙŠØ©\nğŸ  Ø·Ù„Ø¨ Ø§Ù„Ø±Ø¹Ø§ÙŠØ© Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ©\nğŸ” Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…\nâš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹\n\nØ§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ø£Ùˆ Ø§Ø·Ù„Ø¨ Ù…Ø³Ø§Ø¹Ø¯Ø©ØŒ ÙˆØ³Ø£ÙƒÙˆÙ† Ø³Ø¹ÙŠØ¯Ø§Ù‹ Ø¨Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ! ğŸ’ª</div>
    </div>
    <div style="padding: 15px; border-top: 1px solid var(--border); display: flex; gap: 10px;">
        <input type="text" id="ai-input" style="margin:0; padding:10px; flex:1; border:1px solid var(--border); border-radius:8px; font-family:inherit;" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ..." autocomplete="off">
        <button onclick="askAI()" style="border:none; background:var(--p-color); color:white; border-radius:8px; padding:10px 15px; cursor:pointer; transition:all 0.3s; font-size:1.1rem;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'"><i class="fas fa-paper-plane"></i></button>
    </div>
</div>

<div id="m-em" class="modal-full" onclick="toggleEM()">
    <div class="modal-box" onclick="event.stopPropagation()">
        <h2 style="color:var(--d-color); margin-top:0;"><i class="fas fa-heart-pulse"></i> Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø³Ø±ÙŠØ¹Ø©</h2>
        <div id="tip-display" class="tip-card"></div>
        <div style="display: flex; flex-direction: column; gap: 12px;">
            <a href="tel:14" style="text-decoration:none; display:flex; justify-content:space-between; align-items:center; background:#e67e22; color:white; padding:20px; border-radius:20px; font-weight:bold; font-size:1.2rem;">
                <span>Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ù…Ø¯Ù†ÙŠØ©</span><span>14 ğŸš’</span>
            </a>
            <a href="tel:115" style="text-decoration:none; display:flex; justify-content:space-between; align-items:center; background:var(--d-color); color:white; padding:20px; border-radius:20px; font-weight:bold; font-size:1.2rem;">
                <span>Ø§Ù„Ø¥Ø³Ø¹Ø§Ù Ø§Ù„Ø·Ø¨ÙŠ</span><span>115 ğŸš‘</span>
            </a>
        </div>
        <button onclick="toggleEM()" style="margin-top:20px; background:none; border:none; color:#888; cursor:pointer;">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<div id="m-qr" class="modal-full">
    <div class="modal-box">
        <h2 style="color:var(--p-color);">Ø§ÙƒØªÙ…Ù„ Ø§Ù„Ø­Ø¬Ø² Ø¨Ù†Ø¬Ø§Ø­!</h2>
        <div id="qr-target" style="display:flex; justify-content:center; margin:25px 0;"></div>
        <p id="ref-num" style="font-weight:900; font-size:1.5rem; color:var(--s-color); letter-spacing:1px;"></p>
        <p style="font-size:0.8rem; opacity:0.6;">Ø§Ø­ØªÙØ¸ Ø¨Ø§Ù„ÙƒÙˆØ¯ Ù„ØªÙ‚Ø¯ÙŠÙ…Ù‡ Ø¹Ù†Ø¯ Ø´Ø¨Ø§Ùƒ Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„</p>
        <button class="action-btn" style="background:var(--d-color);" onclick="location.reload()">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<script>
    // ==========================================
    // Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ù„ÙˆØ¯Ø± (Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„)
    // ==========================================
    window.addEventListener('load', function() {
        setTimeout(() => {
            const loader = document.getElementById('loader');
            if (loader) loader.style.display = 'none';
        }, 1000);
    });

    // Ø¥Ø¹Ø¯Ø§Ø¯ Supabase Client Ù…Ø¹ Ø­Ù…Ø§ÙŠØ© Ø¶Ø¯ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
    const SUPABASE_URL = 'https://ughfltzaroqgqgeipksb.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVnaGZsdHphcm9xZ3FnZWlwa3NiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk3NzI3MzMsImV4cCI6MjA4NTM0ODczM30.TZvvGWPab7GM1G2ObIsiBoPUNs0KBFdkkUtIug8NJyE';
    
    // ØªØºÙŠÙŠØ± Ø§Ø³Ù… Ø§Ù„Ù…ØªØºÙŠØ± Ù…Ù† supabase Ø¥Ù„Ù‰ supabaseClient Ù„ØªØ¬Ù†Ø¨ Ø§Ù„ØªØ¶Ø§Ø±Ø¨ Ù…Ø¹ Ø§Ù„Ù…ÙƒØªØ¨Ø©
    let supabaseClient = null;

    try {
        if (typeof window.supabase !== 'undefined') {
            supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            console.log("ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­");
        } else {
            console.warn("Ù…ÙƒØªØ¨Ø© Supabase Ù„Ù… ØªØªØ­Ù…Ù„ Ø¨Ø¹Ø¯ØŒ ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª");
        }
    } catch (err) {
        console.error("Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Supabase:", err);
    }

    // Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ±Ø¬Ù…Ø©
    const translations = {
        ar: {
            title: "Ø§Ø­Ø¬Ø² Ù…Ø³ØªÙ‚Ø¨Ù„Ùƒ Ø§Ù„ØµØ­ÙŠ Ø§Ù„ÙŠÙˆÙ…",
            subtitle: "Ø§Ù„Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„ÙˆØ·Ù†ÙŠØ© Ø§Ù„Ø±Ù‚Ù…ÙŠØ© Ù„Ø±Ø¨Ø· Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø¨Ø§Ù„Ù…Ø¤Ø³Ø³Ø§Øª Ø§Ù„Ø§Ø³ØªØ´ÙØ§Ø¦ÙŠØ©",
            selectHospital: "Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ Ø£Ùˆ Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø·Ø¨ÙŠ:",
            searchPlaceholder: "Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ Ø£Ùˆ Ø§Ù„ÙˆÙ„Ø§ÙŠØ©...",
            or: "Ø£Ùˆ Ø§Ø³ØªØ¹Ù„Ù… Ø¹Ù† Ù…ÙˆØ¹Ø¯Ùƒ",
            trackPhone: "Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø³Ø¬Ù„ Ù„Ù„Ø­Ø¬Ø²...",
            trackBtn: "Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø²",
            clinicTitle: "Ù…ÙˆØ¹Ø¯ Ø·Ø¨ÙŠØ¨ Ø£Ø®ØµØ§Ø¦ÙŠ",
            clinicDesc: "Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª Ø§Ù„Ø¯ÙˆØ±ÙŠØ© ÙˆØ§Ù„ÙØ­ÙˆØµØ§Øª Ø§Ù„ØªØ®ØµØµÙŠØ©",
            homeTitle: "Ø§Ù„Ø±Ø¹Ø§ÙŠØ© Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ©",
            homeDesc: "Ø·Ù„Ø¨ Ø·Ø§Ù‚Ù… Ø·Ø¨ÙŠ Ù„Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ù…Ø±ÙŠØ¶ ÙÙŠ Ù…Ù†Ø²Ù„Ù‡",
            firstName: "Ø§Ù„Ø§Ø³Ù…",
            lastName: "Ø§Ù„Ù„Ù‚Ø¨",
            nin: "Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙ Ø§Ù„ÙˆØ·Ù†ÙŠ (NIN):",
            phone: "Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø±ÙŠØ¶:",
            specialty: "-- Ø§Ø®ØªØ± Ø§Ù„ØªØ®ØµØµ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ --",
            confirmBtn: "ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ÙˆØ¹Ø¯",
            patientName: "Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ù…Ø±ÙŠØ¶",
            guardianPhone: "Ø±Ù‚Ù… Ù‡Ø§ØªÙ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±",
            caseDesc: "ÙˆØµÙ Ù…ÙˆØ¬Ø² Ù„Ù„Ø­Ø§Ù„Ø© Ø§Ù„ØµØ­ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©...",
            address: "Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø³ÙƒÙ†ÙŠ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ",
            submitBtn: "Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¹Ø§Ø¬Ù„",
            aiHelper: "Ù…Ø³Ø§Ø¹Ø¯ Ø´ÙØ§Ø¡ Ø§Ù„Ø°ÙƒÙŠ",
            aiMsg: "Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹! ğŸ˜Š\n\nØ£Ù†Ø§ Ø´ÙØ§Ø¡ØŒ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒÙŠ ÙÙŠ Ù…Ù†ØµØ© Ø´ÙØ§Ø¡ ğŸ’™\n\nØ£Ù†Ø§ Ù‡Ù†Ø§ Ù„Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ ÙƒÙ„ Ø´ÙŠØ¡:\nğŸ¥ Ø­Ø¬Ø² Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø·Ø¨ÙŠØ©\nğŸ  Ø·Ù„Ø¨ Ø§Ù„Ø±Ø¹Ø§ÙŠØ© Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ©\nğŸ” Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…\nâš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹\n\nØ§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ø£Ùˆ Ø§Ø·Ù„Ø¨ Ù…Ø³Ø§Ø¹Ø¯Ø©ØŒ ÙˆØ³Ø£ÙƒÙˆÙ† Ø³Ø¹ÙŠØ¯Ø§Ù‹ Ø¨Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ! ğŸ’ª",
            emergency: "Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø³Ø±ÙŠØ¹Ø©",
            tip: "Ù†ØµÙŠØ­Ø© Ø·Ø¨ÙŠØ©:",
            successTitle: "Ø§ÙƒØªÙ…Ù„ Ø§Ù„Ø­Ø¬Ø² Ø¨Ù†Ø¬Ø§Ø­!",
            successMsg: "Ø§Ø­ØªÙØ¸ Ø¨Ø§Ù„ÙƒÙˆØ¯ Ù„ØªÙ‚Ø¯ÙŠÙ…Ù‡ Ø¹Ù†Ø¯ Ø´Ø¨Ø§Ùƒ Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„",
            spec_general: "Ø·Ø¨ Ø¹Ø§Ù…",
            spec_eyes: "Ø£Ù…Ø±Ø§Ø¶ Ø§Ù„Ø¹ÙŠÙˆÙ†",
            spec_heart: "Ø£Ù…Ø±Ø§Ø¶ Ø§Ù„Ù‚Ù„Ø¨",
            spec_neuro: "Ø§Ù„Ø£Ø¹ØµØ§Ø¨",
            spec_children: "Ø§Ù„Ø£Ø·ÙØ§Ù„"
        },
        en: {
            title: "Book Your Health Future Today",
            subtitle: "National Digital Portal to Connect Patients with Healthcare Institutions",
            selectHospital: "Choose a Hospital or Medical Center:",
            searchPlaceholder: "Search by hospital name or state...",
            or: "Or check your appointment",
            trackPhone: "Phone number registered for booking...",
            trackBtn: "Retrieve Booking Information",
            clinicTitle: "Specialist Doctor Appointment",
            clinicDesc: "For regular consultations and specialized examinations",
            homeTitle: "Home Care",
            homeDesc: "Request a medical team to visit the patient at home",
            firstName: "First Name",
            lastName: "Last Name",
            nin: "National ID Number (NIN):",
            phone: "Patient Phone Number:",
            specialty: "-- Choose Required Specialty --",
            confirmBtn: "Confirm Appointment",
            patientName: "Patient Full Name",
            guardianPhone: "Guardian Phone Number",
            caseDesc: "Brief description of current health condition...",
            address: "Detailed Home Address",
            submitBtn: "Submit Urgent Request",
            aiHelper: "Shifaa Smart Assistant",
            aiMsg: "Hello! ğŸ‘‹\n\nI'm Shifaa, your smart assistant on Shifaa platform ğŸ’™\n\nI'm here to help you with everything:\nğŸ¥ Book medical appointments\nğŸ  Request home care services\nğŸ” Search and inquiries\nâš™ï¸ Website settings\n\nWrite your question or ask for help, and I'll be happy to assist you! ğŸ’ª",
            emergency: "Emergency Response",
            tip: "Medical Tip:",
            successTitle: "Booking Completed Successfully!",
            successMsg: "Keep the code to present it at the reception",
            spec_general: "General Medicine",
            spec_eyes: "Ophthalmology",
            spec_heart: "Cardiology",
            spec_neuro: "Neurology",
            spec_children: "Pediatrics"
        },
        fr: {
            title: "RÃ©servez votre Avenir de SantÃ© Aujourd'hui",
            subtitle: "Portail NumÃ©rique National pour Connecter les Patients aux Ã‰tablissements de SantÃ©",
            selectHospital: "Choisissez un HÃ´pital ou un Centre MÃ©dical:",
            searchPlaceholder: "Rechercher par nom d'hÃ´pital ou Ã©tat...",
            or: "Ou consultez votre rendez-vous",
            trackPhone: "NumÃ©ro de tÃ©lÃ©phone enregistrÃ© pour la rÃ©servation...",
            trackBtn: "RÃ©cupÃ©rer les Informations de RÃ©servation",
            clinicTitle: "Rendez-vous MÃ©decin SpÃ©cialiste",
            clinicDesc: "Pour les consultations rÃ©guliÃ¨res et examens spÃ©cialisÃ©s",
            homeTitle: "Soins Ã  Domicile",
            homeDesc: "Demander une Ã©quipe mÃ©dicale pour visiter le patient Ã  domicile",
            firstName: "PrÃ©nom",
            lastName: "Nom",
            nin: "NumÃ©ro d'Identification Nationale (NIN):",
            phone: "NumÃ©ro de TÃ©lÃ©phone du Patient:",
            specialty: "-- Choisissez la SpÃ©cialitÃ© Requise --",
            confirmBtn: "Confirmer le Rendez-vous",
            patientName: "Nom Complet du Patient",
            guardianPhone: "NumÃ©ro de TÃ©lÃ©phone du Tuteur",
            caseDesc: "Description brÃ¨ve de l'Ã©tat de santÃ© actuel...",
            address: "Adresse RÃ©sidentielle DÃ©taillÃ©e",
            submitBtn: "Soumettre la Demande Urgente",
            aiHelper: "Assistant Intelligent Shifaa",
            aiMsg: "Bonjour! ğŸ‘‹\n\nJe suis Shifaa, votre assistant intelligent sur la plateforme Shifaa ğŸ’™\n\nJe suis lÃ  pour vous aider dans tout:\nğŸ¥ RÃ©server des rendez-vous mÃ©dicaux\nğŸ  Demander des services de soins Ã  domicile\nğŸ” Recherche et informations\nâš™ï¸ ParamÃ¨tres du site\n\nÃ‰crivez votre question ou demandez de l'aide, et je serai heureux de vous assister! ğŸ’ª",
            emergency: "RÃ©ponse d'Urgence",
            tip: "Conseil MÃ©dical:",
            successTitle: "RÃ©servation ComplÃ©tÃ©e avec SuccÃ¨s!",
            successMsg: "Gardez le code Ã  prÃ©senter Ã  la rÃ©ception",
            spec_general: "MÃ©decine GÃ©nÃ©rale",
            spec_eyes: "Ophtalmologie",
            spec_heart: "Cardiologie",
            spec_neuro: "Neurologie",
            spec_children: "PÃ©diatrie"
        }
    };

    let currentLang = localStorage.getItem('selectedLanguage') || 'ar';

    function toggleLangMenu() {
        const menu = document.getElementById('lang-menu');
        menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
    }

    function setLanguage(lang) {
        if (!lang || !translations[lang]) return;
        currentLang = lang;
        localStorage.setItem('selectedLanguage', lang);
        updatePageLanguage();
        updateAIChatMessage();
        updateSpecialties();
        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
        document.getElementById('lang-menu').style.display = 'none';
    }

    function t(key) {
        return translations[currentLang][key] || translations['ar'][key];
    }

    function updatePageLanguage() {
        document.documentElement.lang = currentLang;
        document.documentElement.dir = currentLang === 'ar' ? 'rtl' : 'ltr';
        
        // ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†ØµÙˆØµ
        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.dataset.i18n;
            el.textContent = t(key);
        });
        document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
            const key = el.dataset.i18nPlaceholder;
            el.placeholder = t(key);
        });
    }

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù„ØºØ© Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØµÙØ­Ø©
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
            updatePageLanguage();
        });
    } else {
        updatePageLanguage();
    }

    // ØªØ­Ø¯ÙŠØ« Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ©
    function updateAIChatMessage() {
        const chatLogs = document.getElementById('chat-logs');
        const firstBubble = chatLogs.querySelector('.b-bot');
        if (firstBubble) {
            firstBubble.textContent = t('aiMsg');
        }
    }

    // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ®ØµØµØ§Øª Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ©
    function updateSpecialties() {
        const specSelect = document.getElementById('p-spec');
        if (specSelect) {
            const options = [
                { value: '', text: t('specialty') },
                { value: 'general', text: t('spec_general') },
                { value: 'eyes', text: t('spec_eyes') },
                { value: 'heart', text: t('spec_heart') },
                { value: 'neuro', text: t('spec_neuro') },
                { value: 'children', text: t('spec_children') }
            ];
            specSelect.innerHTML = '';
            options.forEach(opt => {
                const option = document.createElement('option');
                option.value = opt.value;
                option.textContent = opt.text;
                specSelect.appendChild(option);
            });
        }
    }

    // Ø¥ØºÙ„Ø§Ù‚ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„ØºØ§Øª Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
    document.addEventListener('click', (e) => {
        const langSelector = document.getElementById('lang-selector');
        if (langSelector && !langSelector.contains(e.target)) {
            document.getElementById('lang-menu').style.display = 'none';
        }
    });

    const HOSPITALS = ["Ù…Ø³ØªØ´ÙÙ‰ Ù…ØµØ·ÙÙ‰ Ø¨Ø§Ø´Ø§ Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠ", "Ù…Ø³ØªØ´ÙÙ‰ Ù†ÙÙŠØ³Ø© Ø­Ù…ÙˆØ¯ (Ø¨Ø§Ø±Ù†ÙŠ)", "Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù‚Ø¨Ø© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ", "Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø´ÙØ§Ø¡ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©", "Ù…Ø³ØªØ´ÙÙ‰ Ø¹ÙŠÙ† Ø§Ù„Ù†Ø¹Ø¬Ø© Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠ", "Ù…Ø³ØªØ´ÙÙ‰ Ù„Ù…ÙŠÙ† Ø¯Ø¨Ø§ØºÙŠÙ†"];
    const TIPS = [
        "Ø¹Ù†Ø¯ Ø­Ø¯ÙˆØ« Ø¥ØºÙ…Ø§Ø¡ØŒ Ø§Ø±ÙØ¹ Ø£Ø±Ø¬Ù„ Ø§Ù„Ù…ØµØ§Ø¨ Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù„Ø¶Ù…Ø§Ù† ÙˆØµÙˆÙ„ Ø§Ù„Ø¯Ù… Ù„Ù„Ø¯Ù…Ø§Øº.",
        "ÙÙŠ Ø­Ø§Ù„ Ø§Ù„ØªØ³Ù…Ù…ØŒ Ù„Ø§ ØªØ´Ø±Ø¨ Ø§Ù„Ø­Ù„ÙŠØ¨Ø› Ø¨Ù„ Ø§ØªØµÙ„ ÙÙˆØ±Ø§Ù‹ Ø¨Ø§Ù„Ø±Ù‚Ù… 115 Ù„Ø·Ù„Ø¨ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡.",
        "Ø´Ø±Ø¨ ÙƒÙ…ÙŠØ§Øª ÙƒØ§ÙÙŠØ© Ù…Ù† Ø§Ù„Ù…Ø§Ø¡ ÙŠØ­Ø³Ù† ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ÙƒØ¨Ø¯ ÙˆØ§Ù„ÙƒÙ„Ù‰ Ø¨Ø´ÙƒÙ„ ÙƒØ¨ÙŠØ±.",
        "Ø¥Ø°Ø§ Ø´Ø¹Ø±Øª Ø¨Ø¢Ù„Ø§Ù… ÙÙŠ Ø§Ù„ØµØ¯Ø±ØŒ ØªÙˆÙ‚Ù Ø¹Ù† Ø£ÙŠ Ù…Ø¬Ù‡ÙˆØ¯ ÙˆØ§ØªØµÙ„ Ø¨Ø§Ù„Ø¥Ø³Ø¹Ø§Ù ÙÙˆØ±Ø§Ù‹."
    ];

    function toggleTheme() {
        document.body.classList.toggle('dark-mode');
    }

    // Ø§Ù„Ø¨Ø­Ø«
    function filterHosp() {
        const v = document.getElementById('h-input').value;
        const res = document.getElementById('h-results');
        res.innerHTML = '';
        if(!v) return;
        HOSPITALS.filter(h => h.includes(v)).forEach(h => {
            const d = document.createElement('div');
            d.className = 'hosp-item';
            d.innerHTML = `<i class="fas fa-hospital"></i> ${h}`;
            d.onclick = () => selectHosp(h);
            res.appendChild(d);
        });
    }

    function selectHosp(name) {
        document.getElementById('current-hosp').innerText = name;
        if (typeof gsap !== 'undefined') {
            gsap.to("#home-sec", { opacity:0, y:-30, duration:0.4, onComplete: () => {
                document.getElementById('home-sec').style.display = 'none';
                document.getElementById('book-sec').style.display = 'flex';
                gsap.from("#book-sec", { opacity:0, y:30, duration:0.5 });
            }});
        } else {
            document.getElementById('home-sec').style.display = 'none';
            document.getElementById('book-sec').style.display = 'flex';
        }
    }

    // ØªÙˆØ³ÙŠØ¹ Ø§Ù„ÙÙˆØ±Ù…
    function expandForm(type) {
        const c = document.getElementById('c-clinic');
        const h = document.getElementById('c-home');
        
        if (typeof gsap !== 'undefined') {
            if(type === 'clinic') {
                gsap.to(h, { opacity:0, display:'none' });
                gsap.to(c, { width:'100%', maxWidth:'750px' });
                document.getElementById('form-clinic').style.display = 'block';
            } else {
                gsap.to(c, { opacity:0, display:'none' });
                gsap.to(h, { width:'100%', maxWidth:'750px' });
                document.getElementById('form-home').style.display = 'block';
            }
        } else {
            // Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¨Ø¯ÙˆÙ† Ø£Ù†ÙŠÙ…ÙŠØ´Ù†
            if(type === 'clinic') {
                h.style.display = 'none';
                c.style.width = '100%';
                c.style.maxWidth = '750px';
                document.getElementById('form-clinic').style.display = 'block';
            } else {
                c.style.display = 'none';
                h.style.width = '100%';
                h.style.maxWidth = '750px';
                document.getElementById('form-home').style.display = 'block';
            }
        }
    }

    // Ø¯Ø§Ù„Ø© Ù„ØªÙˆÙ„ÙŠØ¯ Ø±Ù…Ø² Ø­Ø¬Ø² ÙØ±ÙŠØ¯
    function generateBookingCode() {
        const prefix = 'SHF';
        const timestamp = Date.now().toString(36).toUpperCase();
        const random = Math.random().toString(36).substring(2, 6).toUpperCase();
        return `${prefix}-${timestamp}-${random}`;
    }

    // Ø§Ù„Ø­Ø¬Ø² Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
    async function confirmFinal(mode) {
        if (!supabaseClient) {
            alert("Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ØªØ£ÙƒØ¯ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.");
            return;
        }

        const hospitalName = document.getElementById('current-hosp').innerText;
        
        if(mode === 'clinic') {
            const firstName = document.getElementById('p-fn').value;
            const lastName = document.getElementById('p-ln').value;
            const nin = document.getElementById('p-nin').value;
            const tel = document.getElementById('p-tel').value;
            const specialty = document.getElementById('p-spec').value;
            const appointmentDate = document.getElementById('p-date').value;
            
            if(!firstName || !lastName || !nin || !tel || nin.length < 5 || !specialty || !appointmentDate) {
                alert("ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­!");
                return;
            }
            
            try {
                // 1. Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±ÙŠØ¶
                const { data: patientData, error: patientError } = await supabaseClient
                    .from('patients')
                    .insert([{
                        full_name: `${firstName} ${lastName}`,
                        phone: tel,
                        national_id: nin,
                        birth_date: null
                    }])
                    .select()
                    .single();
                
                if (patientError) throw patientError;
                
                // 2. Ø¥Ù†Ø´Ø§Ø¡ Ø±Ù…Ø² Ø§Ù„Ø­Ø¬Ø²
                const bookingCode = generateBookingCode();
                
                // 3. Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ¹Ø¯
                const { data: appointmentData, error: appointmentError } = await supabaseClient
                    .from('appointments')
                    .insert([{
                        patient_id: patientData.id,
                        hospital_name: hospitalName,
                        service_type: 'clinic',
                        appointment_date: appointmentDate,
                        specialty: specialty,
                        booking_code: bookingCode,
                        status: 'pending'
                    }])
                    .select()
                    .single();
                
                if (appointmentError) throw appointmentError;
                
                showSuccessModal(bookingCode);
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø¬Ø²:', error);
                alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø¬Ø²: " + error.message);
            }
        } else {
            // Ø§Ù„Ø±Ø¹Ø§ÙŠØ© Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ©
            const patientName = document.getElementById('h-name').value;
            const guardianPhone = document.getElementById('h-tel').value;
            const caseDescription = document.getElementById('h-case').value;
            const homeAddress = document.getElementById('h-addr').value;
            
            if(!patientName || !guardianPhone || !homeAddress) {
                alert("ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©!");
                return;
            }
            
            try {
                const { data, error } = await supabaseClient
                    .from('homecare_requests')
                    .insert([{
                        patient_name: patientName,
                        phone: guardianPhone,
                        address: homeAddress,
                        medical_condition: caseDescription,
                        request_date: new Date().toISOString(),
                        status: 'pending'
                    }])
                    .select()
                    .single();
                
                if (error) throw error;
                
                const code = "HOME-" + data.id.toString().padStart(6, '0');
                showSuccessModal(code);
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø·Ù„Ø¨ Ø§Ù„Ø±Ø¹Ø§ÙŠØ© Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ©:', error);
                alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨: " + error.message);
            }
        }
    }
    
    // Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© Ø§Ù„Ù†Ø¬Ø§Ø­
    function showSuccessModal(code) {
        document.getElementById('m-qr').style.display = 'flex';
        document.getElementById('ref-num').innerText = code;
        document.getElementById('qr-target').innerHTML = '';
        if (typeof QRCode !== 'undefined') {
            new QRCode(document.getElementById("qr-target"), { text: code, width: 200, height: 200 });
        } else {
            document.getElementById("qr-target").innerText = "QR Code Library Error";
        }
        
        if (typeof gsap !== 'undefined') {
            gsap.from(".modal-box", { scale:0.7, opacity:0, ease:"back.out(1.5)" });
        }
    }

    // Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯
    function toggleAI() {
        const w = document.getElementById('ai-win');
        w.style.display = w.style.display === 'flex' ? 'none' : 'flex';
        if(w.style.display === 'flex') {
            document.getElementById('ai-input').focus();
        }
    }

    const aiResponses = {
        specialty: {
            keywords: ['ØªØ®ØµØµ', 'Ù…ØªØ®ØµØµ', 'Ø¯ÙƒØªÙˆØ±', 'Ø·Ø¨ÙŠØ¨', 'Ø£ÙŠ ØªØ®ØµØµ', 'Ù…Ø§ Ø§Ù„', 'Ø§ÙŠØ´', 'Ø´Ù†Ùˆ'],
            response: 'Ø§Ù„ØªØ®ØµØµØ§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©:\n\nğŸ¥ â€¢ Ø·Ø¨ Ø¹Ø§Ù…\nâ¤ï¸ â€¢ Ø£Ù…Ø±Ø§Ø¶ Ø§Ù„Ù‚Ù„Ø¨\nğŸ‘¶ â€¢ Ø§Ù„Ø£Ø·ÙØ§Ù„\nğŸ¦´ â€¢ Ø§Ù„Ø¹Ø¸Ø§Ù…\nğŸ¦· â€¢ Ø§Ù„Ø£Ø³Ù†Ø§Ù†\nğŸ‘ï¸ â€¢ Ø§Ù„Ø¹ÙŠÙˆÙ†\n\nØ§Ø®ØªØ± Ø§Ù„ØªØ®ØµØµ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ ÙˆØ³Ù†Ø³Ø§Ø¹Ø¯Ùƒ ÙÙŠ Ø§Ù„Ø­Ø¬Ø²!'
        },
        booking: {
            keywords: ['Ø­Ø¬Ø²', 'Ù…ÙˆØ¹Ø¯', 'Ù…ÙˆØ¹Ø¯ Ø·Ø¨ÙŠ', 'Ø£Ø­Ø¬Ø²', 'Ø§Ø±ÙŠØ¯', 'Ø£Ø¨ÙŠ', 'Ø£Ø±ÙŠØ¯ Ø­Ø¬Ø²', 'ÙƒÙŠÙ Ø§Ø­Ø¬Ø²'],
            response: 'Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø­Ø¬Ø²:\n\n1ï¸âƒ£ Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¨Ø­Ø«\n2ï¸âƒ£ Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©:\n   â€¢ Ø¹ÙŠØ§Ø¯Ø©: Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª Ø§Ù„ØªØ®ØµØµÙŠØ©\n   â€¢ Ø±Ø¹Ø§ÙŠØ© Ù…Ù†Ø²Ù„ÙŠØ©: Ù„Ù„Ø²ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ©\n3ï¸âƒ£ Ù…Ù„Ø£ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±ÙŠØ¶\n4ï¸âƒ£ Ø­Ø¯Ø¯ Ø§Ù„ØªØ®ØµØµ ÙˆØ§Ù„ØªØ§Ø±ÙŠØ®\n5ï¸âƒ£ Ø³ÙŠØ¸Ù‡Ø± Ø±Ù…Ø² Ø§Ù„Ø­Ø¬Ø² Ù…Ø¹ QR\n\nğŸ’¾ Ø§Ø­ÙØ¸ Ø§Ù„Ø±Ù…Ø² ÙˆØ§Ø³ØªØ®Ø¯Ù…Ù‡ ÙÙŠ Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„!'
        },
        homecare: {
            keywords: ['Ù…Ù†Ø²Ù„', 'Ù…Ù†Ø²Ù„ÙŠØ©', 'Ø±Ø¹Ø§ÙŠØ©', 'Ø²ÙŠØ§Ø±Ø© Ø¨ÙŠØª', 'Ø²ÙŠØ§Ø±Ø© Ù…Ù†Ø²Ù„', 'ØªÙ…Ø±ÙŠØ¶', 'Ø¨ÙŠØªÙŠ'],
            response: 'Ø®Ø¯Ù…Ø© Ø§Ù„Ø±Ø¹Ø§ÙŠØ© Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ©:\n\nâœ… Ø·Ø§Ù‚Ù… Ø·Ø¨ÙŠ Ù…Ø­ØªØ±Ù ÙŠØ£ØªÙŠ Ù„Ù…Ù†Ø²Ù„Ùƒ\nâœ… Ø®Ø¯Ù…Ø§Øª Ø§Ù„ØªÙ…Ø±ÙŠØ¶ Ø§Ù„Ù…Ù†Ø²Ù„ÙŠ\nâœ… Ø§Ø³ØªØ´Ø§Ø±Ø§Øª Ø·Ø¨ÙŠØ© Ù…Ù†Ø²Ù„ÙŠØ©\nâœ… Ù…ØªØ§Ø¨Ø¹Ø© Ø¯ÙˆØ±ÙŠØ© Ø¢Ù…Ù†Ø©\n\nğŸ“‹ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:\nâ€¢ Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶\nâ€¢ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ\nâ€¢ ÙˆØµÙ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„ØµØ­ÙŠØ©\nâ€¢ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø³ÙƒÙ†ÙŠ\n\nØ§Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø§Ù„Ø±Ø¹Ø§ÙŠØ© Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ©" ÙˆØ£Ø¯Ø®Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!'
        },
        tracking: {
            keywords: ['ØªØªØ¨Ø¹', 'Ø­Ø§Ù„Ø©', 'Ù…ÙˆØ¹Ø¯ÙŠ', 'Ø±Ù‚Ù…', 'Ø§Ù„Ø­Ø¬Ø²', 'Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø¬Ø²', 'Ø¨Ø­Ø«', 'Ø§Ø³ØªØ¹Ù„Ø§Ù…', 'Ø£ÙŠÙ†'],
            response: 'ØªØªØ¨Ø¹ Ø­Ø¬Ø²Ùƒ:\n\nğŸ” Ø§Ù„Ø®Ø·ÙˆØ§Øª:\n1ï¸âƒ£ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø§Ø³ØªØ¹Ù„Ù… Ø¹Ù† Ù…ÙˆØ¹Ø¯Ùƒ"\n2ï¸âƒ£ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø³Ø¬Ù„\n3ï¸âƒ£ Ø³ØªØ¸Ù‡Ø± Ø¬Ù…ÙŠØ¹ Ø­Ø¬ÙˆØ²Ø§ØªÙƒ\n\nâš ï¸ Ù‡Ø§Ù…:\nâ€¢ Ø§Ø³ØªØ®Ø¯Ù… Ù†ÙØ³ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø³Ø¬Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø¬Ø²\nâ€¢ Ø³ÙŠØ¸Ù‡Ø± Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„Ù…Ø³ØªØ´ÙÙ‰ ÙˆØ§Ù„ØªØ®ØµØµ\nâ€¢ Ø§Ø­ÙØ¸ Ø±Ù‚Ù…Ùƒ Ù„Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ©'
        },
        emergency: {
            keywords: ['Ø·ÙˆØ§Ø±Ø¦', 'Ø­Ø§Ù„Ø© Ø­Ø±Ø¬Ø©', 'Ø­Ø§Ù„Ø© Ø·Ø§Ø±Ø¦Ø©', 'Ø¥Ø³Ø¹Ø§Ù', 'Ø³Ø±ÙŠØ¹', 'Ø®Ø·ÙŠØ±', 'ÙÙˆØ±ÙŠ', 'Ø­Ø±Ø¬'],
            response: 'Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø³Ø±ÙŠØ¹Ø©:\n\nğŸš‘ Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø·ÙˆØ§Ø±Ø¦:\nâ€¢ Ø¥Ø³Ø¹Ø§Ù Ø·Ø¨ÙŠ: 115\nâ€¢ Ø­Ù…Ø§ÙŠØ© Ù…Ø¯Ù†ÙŠØ©: 14\n\nâš¡ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø©:\nâœ“ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± "âš¡ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø³Ø±ÙŠØ¹Ø©" (Ø§Ù„Ø²Ø± Ø§Ù„Ø£Ø­Ù…Ø±)\nâœ“ Ø³ØªØ¬Ø¯ Ù†ØµØ§Ø¦Ø­ Ø¥Ø³Ø¹Ø§ÙØ§Øª Ø£ÙˆÙ„ÙŠØ© Ù…Ù‡Ù…Ø©\nâœ“ Ù‚Ø§Ø¦Ù…Ø© Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø·ÙˆØ§Ø±Ø¦\n\nğŸ”´ ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø·ÙˆØ§Ø±Ø¦: Ø§ØªØµÙ„ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ù€ 115'
        },
        language: {
            keywords: ['Ù„ØºØ©', 'ØªØ±Ø¬Ù…Ø©', 'Ø¹Ø±Ø¨ÙŠ', 'Ø§Ù†Ø¬Ù„ÙŠØ²ÙŠ', 'ÙØ±Ù†Ø³ÙŠ', 'ØªØºÙŠØ± Ù„ØºØ©', 'ØºÙŠØ± Ø§Ù„Ù„ØºØ©', 'language', 'english', 'franÃ§ais'],
            response: 'ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ©:\n\nğŸŒ Ø§Ù„Ø®Ø·ÙˆØ§Øª:\n1ï¸âƒ£ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„ÙƒØ±Ø© Ø§Ù„Ø£Ø±Ø¶ÙŠØ© ğŸŒ\n2ï¸âƒ£ Ø§Ø®ØªØ± Ø§Ù„Ù„ØºØ© Ø§Ù„Ù…ÙØ¶Ù„Ø©:\n   â€¢ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø¹\n   â€¢ English En\n   â€¢ FranÃ§ais Fr\n3ï¸âƒ£ Ø³ØªØªØºÙŠØ± Ø¬Ù…ÙŠØ¹ Ù†ØµÙˆØµ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙÙˆØ±Ø§Ù‹\n\nğŸ’¾ Ø§Ù„Ù„ØºØ© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© ØªÙØ­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹!'
        },
        darkmode: {
            keywords: ['Ù…Ø¸Ù„Ù…', 'Ø¯Ø§ÙƒÙ†', 'ÙˆØ¶Ø¹', 'Ù„ÙŠÙ„', 'Ù†Ù‡Ø§Ø±', 'Ø§Ø¶Ø§Ø¡Ø©', 'Ø¶ÙˆØ¡', 'dark', 'light', 'theme'],
            response: 'ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ (Ù†Ù‡Ø§Ø±/Ù„ÙŠÙ„):\n\nğŸŒ“ Ø§Ù„Ø®Ø·ÙˆØ§Øª:\n1ï¸âƒ£ Ø§Ø¨Ø­Ø« Ø¹Ù† Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù‚Ù…Ø±/Ø§Ù„Ø´Ù…Ø³ ğŸŒ™\n2ï¸âƒ£ Ø§Ø¶ØºØ· Ø¹Ù„ÙŠÙ‡Ø§ Ù„ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹\n\nğŸ“± Ø§Ù„Ø£ÙˆØ¶Ø§Ø¹ Ø§Ù„Ù…ØªØ§Ø­Ø©:\nâ˜€ï¸ ÙˆØ¶Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø±: Ø£Ù„ÙˆØ§Ù† ÙØ§ØªØ­Ø© ÙˆØ²Ø§Ù‡ÙŠØ©\nğŸŒ™ ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„: Ø£Ù„ÙˆØ§Ù† Ø¯Ø§ÙƒÙ†Ø© ÙˆÙ‡Ø§Ø¯Ø¦Ø©\n\nğŸ’¡ Ø§Ø®ØªØ± Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ù„Ø±Ø§Ø­Ø© Ø¹ÙŠÙ†ÙŠÙƒ!'
        },
        hospital: {
            keywords: ['Ù…Ø³ØªØ´ÙÙ‰', 'Ù…Ø±ÙƒØ²', 'Ø¹ÙŠØ§Ø¯Ø©', 'Ø·Ø¨ÙŠ', 'Ù…Ø¤Ø³Ø³Ø©', 'Ø£ÙŠÙ†', 'Ø§Ù„ÙˆÙ„Ø§ÙŠØ©', 'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©', 'Ø§Ù„Ø¨Ø­Ø«'],
            response: 'Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø³ØªØ´ÙÙŠØ§Øª:\n\nğŸ¥ Ø§Ù„Ù…Ø³ØªØ´ÙÙŠØ§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©:\nâ€¢ Ù…Ø³ØªØ´ÙÙ‰ Ù…ØµØ·ÙÙ‰ Ø¨Ø§Ø´Ø§ Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠ\nâ€¢ Ù…Ø³ØªØ´ÙÙ‰ Ù†ÙÙŠØ³Ø© Ø­Ù…ÙˆØ¯ (Ø¨Ø§Ø±Ù†ÙŠ)\nâ€¢ Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù‚Ø¨Ø© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ\nâ€¢ Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø´ÙØ§Ø¡ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©\nâ€¢ Ù…Ø³ØªØ´ÙÙ‰ Ø¹ÙŠÙ† Ø§Ù„Ù†Ø¹Ø¬Ø© Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠ\nâ€¢ Ù…Ø³ØªØ´ÙÙ‰ Ù„Ù…ÙŠÙ† Ø¯Ø¨Ø§ØºÙŠÙ†\n\nğŸ” Ø§Ù„Ø®Ø·ÙˆØ§Øª:\n1ï¸âƒ£ Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ ÙÙŠ Ø§Ù„Ø¨Ø­Ø«\n2ï¸âƒ£ Ø§Ø®ØªØ± Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©\n3ï¸âƒ£ Ø«Ù… Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©'
        },
        clinic: {
            keywords: ['Ø¹ÙŠØ§Ø¯Ø©', 'Ù…Ø±Ø§Ø¬Ø¹Ø©', 'ÙØ­Øµ', 'Ø§Ø®ØªØµØ§ØµÙŠ', 'Ù…ØªØ®ØµØµ', 'clinic'],
            response: 'Ø­Ø¬Ø² Ø¹ÙŠØ§Ø¯Ø© Ø·Ø¨ÙŠØ©:\n\nğŸ‘¨â€âš•ï¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø¬Ø²:\nâ€¢ Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±Ø© Ø§Ù„Ø·Ø¨ÙŠØ©\nâ€¢ Ù…Ø¹ Ø·Ø¨ÙŠØ¨ Ù…ØªØ®ØµØµ\nâ€¢ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ÙˆÙØ­ÙˆØµØ§Øª\n\nğŸ“ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:\n1ï¸âƒ£ Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„\n2ï¸âƒ£ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ\n3ï¸âƒ£ Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙ Ø§Ù„ÙˆØ·Ù†ÙŠ\n4ï¸âƒ£ Ø§Ù„ØªØ®ØµØµ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨\n5ï¸âƒ£ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù…ÙØ¶Ù„\n\nâœ… Ø³ÙŠØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…ÙˆØ¹Ø¯ ÙÙˆØ±Ø§Ù‹!'
        },
        general: {
            keywords: ['Ù…Ø³Ø§Ø¹Ø¯Ø©', 'Ø³Ø§Ø¹Ø¯', 'ÙƒÙŠÙ', 'Ø§ÙŠØ´', 'Ø´Ù†Ùˆ', 'Ù…Ø¹Ù„ÙˆÙ…Ø©', 'Ø§Ø³ØªÙØ³Ø§Ø±'],
            response: 'Ø­Ø³Ù†Ø§Ù‹! ğŸ‘Œ\n\nğŸ“Œ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ:\n\nğŸ¥ Ø·Ù„Ø¨Ø§Øª Ø·Ø¨ÙŠØ©:\nâ€¢ Ø­Ø¬Ø² Ø¹ÙŠØ§Ø¯Ø©\nâ€¢ Ø·Ù„Ø¨ Ø±Ø¹Ø§ÙŠØ© Ù…Ù†Ø²Ù„ÙŠØ©\nâ€¢ ØªØªØ¨Ø¹ Ø§Ù„Ø­Ø¬Ø²\nâ€¢ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØ®ØµØµ\n\nâš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹:\nâ€¢ ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ© ğŸŒ\nâ€¢ ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ (Ù†Ù‡Ø§Ø±/Ù„ÙŠÙ„) ğŸŒ™\nâ€¢ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ´ÙÙŠØ§Øª\n\nğŸš‘ Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø·ÙˆØ§Ø±Ø¦:\nâ€¢ Ù†ØµØ§Ø¦Ø­ Ø¥Ø³Ø¹Ø§ÙØ§Øª Ø£ÙˆÙ„ÙŠØ©\nâ€¢ Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø·ÙˆØ§Ø±Ø¦\n\nÙ‚Ù„ Ù„ÙŠ ÙƒÙŠÙ Ø£Ø³Ø§Ø¹Ø¯Ùƒ! ğŸ˜Š'
        },
        thanks: {
            keywords: ['Ø´ÙƒØ±Ø§', 'Ø´ÙƒØ±Ø§Ù‹', 'Ù…ÙŠØ±Ø³ÙŠ', 'ØªØ´ÙƒØ±', 'Ø´ÙƒØ±', 'Ø§Ù„Ø­Ù…Ø¯', 'thanks', 'thank', 'merci'],
            response: 'Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹! ğŸ˜ŠğŸ’™\n\nØ´Ø±ÙØªÙ†ÙŠ Ø®Ø¯Ù…ØªÙƒØŒ ÙˆØ£Ù†Ø§ Ø³Ø¹ÙŠØ¯ Ø¬Ø¯Ø§Ù‹ Ø¨Ø£Ù†Ù†ÙŠ Ø§Ø³ØªØ·Ø¹Øª Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ!\n\nØ¥Ù† Ø§Ø­ØªØ¬Øª Ù„Ø£ÙŠ Ø´ÙŠØ¡ Ø¢Ø®Ø± ÙÙŠ Ø£ÙŠ ÙˆÙ‚ØªØŒ Ø£Ù†Ø§ Ù‡Ù†Ø§ Ù„Ùƒ Ø¯Ø§Ø¦Ù…Ø§Ù‹. ğŸŒŸ\n\nØªÙ…Ù†ÙŠØ§ØªÙŠ Ù„Ùƒ Ø¨Ø§Ù„ØµØ­Ø© ÙˆØ§Ù„Ø³Ø¹Ø§Ø¯Ø©! ğŸ¥âœ¨'
        },
        appreciation: {
            keywords: ['Ù…Ù…ØªØ§Ø²', 'Ø±Ø§Ø¦Ø¹', 'Ø¹Ø¸ÙŠÙ…', 'Ø¨Ø±Ø§Ø§ÙÙˆ', 'excellent', 'good job', 'Ø£Ø­Ø³Ù†Øª', 'Ø£Ø­Ø³'],
            response: 'ØªØ´Ø±ÙÙ†ÙŠ ÙƒÙ„Ù…Ø§ØªÙƒ Ø§Ù„Ù„Ø·ÙŠÙØ©! ğŸ¥°\n\nØ£Ù†Ø§ Ù…ØªØ®ØµØµ Ù„ØªÙ‚Ø¯ÙŠÙ… Ø£ÙØ¶Ù„ Ø®Ø¯Ù…Ø© Ù„Ùƒ Ø¯Ø§Ø¦Ù…Ø§Ù‹.\n\nÙ‡Ù„ ØªØ±ÙŠØ¯ Ø´ÙŠØ¡ Ø¢Ø®Ø±ØŸ Ø£Ù†Ø§ Ø¨ÙƒÙ„ Ø³Ø±ÙˆØ± Ù‡Ù†Ø§! ğŸ’ªğŸ˜Š'
        },
        greeting: {
            keywords: ['Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…', 'Ø§Ù„Ø³Ù„Ø§Ù…', 'ØµØ¨Ø§Ø­', 'Ù…Ø³Ø§Ø¡', 'ØµØ¨Ø­', 'Ù„ÙŠÙ„', 'hello', 'hi', 'Ù…Ø±Ø­Ø¨Ø§'],
            response: 'ÙˆØ¹Ù„ÙŠÙƒÙ… Ø§Ù„Ø³Ù„Ø§Ù… ÙˆØ±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø±ÙƒØ§ØªÙ‡! ğŸ‘‹\n\nÙƒÙŠÙ Ø­Ø§Ù„Ùƒ Ø§Ù„ÙŠÙˆÙ…ØŸ Ø£ØªÙ…Ù†Ù‰ Ø£Ù† ØªÙƒÙˆÙ† Ø¨Ø£ÙØ¶Ù„ ØµØ­Ø©! ğŸ˜Š\n\nÙƒÙŠÙ ÙŠÙ…ÙƒÙ† Ø£Ù† Ø£Ø³Ø§Ø¹Ø¯Ùƒ ÙÙŠ Ù…Ù†ØµØ© Ø´ÙØ§Ø¡ØŸ'
        }
    };

    function getAIResponse(question) {
        const q = question.toLowerCase().trim();
        for (let category in aiResponses) {
            const keywords = aiResponses[category].keywords;
            if (keywords.some(key => q.includes(key))) {
                return aiResponses[category].response;
            }
        }
        return `Ø´ÙƒØ±Ø§Ù‹ Ø¹Ù„Ù‰ Ø³Ø¤Ø§Ù„Ùƒ! ğŸ˜Š\n\nÙ„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ø£ÙØ¶Ù„ØŒ Ø¬Ø±Ø¨ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©:\n\nâ€¢ ÙƒÙŠÙ Ø§Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯ØŸ\nâ€¢ ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ©\nâ€¢ ÙˆØ¶Ø¹ Ù…Ø¸Ù„Ù…\nâ€¢ ØªØªØ¨Ø¹ Ø­Ø¬Ø²ÙŠ\nâ€¢ Ø§Ù„Ø±Ø¹Ø§ÙŠØ© Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ©\nâ€¢ Ø­Ø§Ù„Ø© Ø·ÙˆØ§Ø±Ø¦\n\nÙ‡Ù„ Ù‡Ù†Ø§Ùƒ Ø´ÙŠØ¡ Ù…Ø­Ø¯Ø¯ØŸ`;
    }

    function askAI() {
        const input = document.getElementById('ai-input');
        const chatLogs = document.getElementById('chat-logs');
        if (!input.value.trim()) return;
        
        const userMessage = input.value;
        const userBubble = document.createElement('div');
        userBubble.className = 'bubble b-user';
        userBubble.textContent = userMessage;
        chatLogs.appendChild(userBubble);
        input.value = '';
        chatLogs.scrollTop = chatLogs.scrollHeight;
        
        setTimeout(() => {
            const aiBubble = document.createElement('div');
            aiBubble.className = 'bubble b-bot';
            aiBubble.style.whiteSpace = 'pre-line';
            aiBubble.textContent = getAIResponse(userMessage);
            chatLogs.appendChild(aiBubble);
            chatLogs.scrollTop = chatLogs.scrollHeight;
        }, 600);
        
        input.focus();
    }

    document.addEventListener('DOMContentLoaded', () => {
        const aiInput = document.getElementById('ai-input');
        if (aiInput) {
            aiInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') askAI();
            });
        }
    });

    function toggleEM() {
        const m = document.getElementById('m-em');
        const isO = m.style.display === 'flex';
        m.style.display = isO ? 'none' : 'flex';
        if(!isO) {
            document.getElementById('tip-display').innerHTML = "<b>Ù†ØµÙŠØ­Ø© Ø·Ø¨ÙŠØ©:</b> " + TIPS[Math.floor(Math.random()*TIPS.length)];
        }
    }

    async function trackBooking() {
        if (!supabaseClient) {
            alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.");
            return;
        }

        const t = document.getElementById('track-id').value;
        if(!t) return alert("Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ù„Ù„Ø¨Ø­Ø«!");
        
        try {
            const { data: patients, error: patientError } = await supabaseClient
                .from('patients')
                .select('id, full_name')
                .eq('phone', t);
            
            if (patientError) throw patientError;
            
            if (!patients || patients.length === 0) {
                alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ÙŠ Ø­Ø¬ÙˆØ²Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù…!");
                return;
            }
            
            const patientIds = patients.map(p => p.id);
            const { data: appointments, error: appointmentsError } = await supabaseClient
                .from('appointments')
                .select('*')
                .in('patient_id', patientIds)
                .order('appointment_date', { ascending: false });
            
            if (appointmentsError) throw appointmentsError;
            
            if (!appointments || appointments.length === 0) {
                alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ÙŠ Ø­Ø¬ÙˆØ²Ø§Øª!");
                return;
            }
            
            showAppointmentsResults(appointments, patients);
            
        } catch (error) {
            console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø­Ø«:', error);
            alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¨Ø­Ø«: " + error.message);
        }
    }
    
    function showAppointmentsResults(appointments, patients) {
        let html = '<div style="background: var(--glass); padding: 30px; border-radius: 20px; max-width: 800px; margin: 0 auto;">';
        html += '<h2 style="color: var(--p-color); margin-bottom: 20px;">Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«</h2>';
        
        appointments.forEach(apt => {
            const patient = patients.find(p => p.id === apt.patient_id);
            const date = new Date(apt.appointment_date);
            const formattedDate = date.toLocaleDateString('ar-DZ', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            html += `
                <div style="background: var(--bg-main); padding: 20px; border-radius: 15px; margin-bottom: 15px; border-left: 4px solid var(--p-color);">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                        <div>
                            <h3 style="margin: 0 0 5px 0; color: var(--p-dark);">${patient ? patient.full_name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</h3>
                            <p style="margin: 0; color: var(--s-color); font-weight: bold;">Ø±Ù…Ø² Ø§Ù„Ø­Ø¬Ø²: ${apt.booking_code}</p>
                        </div>
                        <span style="background: ${apt.status === 'confirmed' ? 'var(--p-color)' : apt.status === 'cancelled' ? 'var(--d-color)' : '#ffa502'}; color: white; padding: 5px 15px; border-radius: 20px; font-size: 0.9rem;">
                            ${apt.status === 'confirmed' ? 'Ù…Ø¤ÙƒØ¯' : apt.status === 'cancelled' ? 'Ù…Ù„ØºÙŠ' : 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±'}
                        </span>
                    </div>
                    <p style="margin: 5px 0;"><strong>Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰:</strong> ${apt.hospital_name}</p>
                    <p style="margin: 5px 0;"><strong>Ø§Ù„ØªØ®ØµØµ:</strong> ${apt.specialty}</p>
                    <p style="margin: 5px 0;"><strong>Ø§Ù„Ù…ÙˆØ¹Ø¯:</strong> ${formattedDate}</p>
                    ${apt.note ? `<p style="margin: 5px 0;"><strong>Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong> ${apt.note}</p>` : ''}
                </div>
            `;
        });
        
        html += '<button class="action-btn" onclick="closeResults()" style="margin-top: 20px; background: var(--d-color);">Ø¥ØºÙ„Ø§Ù‚</button>';
        html += '</div>';
        
        const modal = document.createElement('div');
        modal.id = 'results-modal';
        modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); backdrop-filter: blur(10px); z-index: 10000; display: flex; align-items: center; justify-content: center; padding: 20px; overflow-y: auto;';
        modal.innerHTML = html;
        document.body.appendChild(modal);
    }
    
    function closeResults() {
        const modal = document.getElementById('results-modal');
        if (modal) {
            modal.remove();
        }
    }
</script>
</body>
</html>
